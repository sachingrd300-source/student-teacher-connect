{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user in the EduConnect Pro application.  Could be a teacher, student, or parent.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user.",
          "format": "uuid"
        },
        "role": {
          "type": "string",
          "description": "The role of the user (teacher, student, parent)."
        },
        "name": {
          "type": "string",
          "description": "The name of the user."
        },
        "mobileNumber": {
          "type": "string",
          "description": "The user's mobile number."
        },
        "email": {
          "type": "string",
          "description": "The user's email address.",
          "format": "email"
        }
      },
      "required": [
        "id",
        "role",
        "name",
        "mobileNumber"
      ]
    },
    "Teacher": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Teacher",
      "type": "object",
      "description": "Represents a teacher in the EduConnect Pro application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the teacher.",
          "format": "uuid"
        },
        "userId": {
          "type": "string",
          "description": "Reference to the User entity. (Relationship: User 1:1 Teacher)"
        },
        "verificationCode": {
          "type": "string",
          "description": "Verification code for the teacher."
        }
      },
      "required": [
        "id",
        "userId",
        "verificationCode"
      ]
    },
    "Student": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Student",
      "type": "object",
      "description": "Represents a student in the EduConnect Pro application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the student.",
          "format": "uuid"
        },
        "userId": {
          "type": "string",
          "description": "Reference to the User entity. (Relationship: User 1:1 Student)"
        },
        "teacherId": {
          "type": "string",
          "description": "Reference to the Teacher entity. (Relationship: Teacher 1:N Student). Nullable if the student is independent"
        },
        "isApproved": {
          "type": "boolean",
          "description": "Indicates whether the student is approved by the teacher."
        }
      },
      "required": [
        "id",
        "userId"
      ]
    },
    "Parent": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Parent",
      "type": "object",
      "description": "Represents a parent in the EduConnect Pro application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the parent.",
          "format": "uuid"
        },
        "userId": {
          "type": "string",
          "description": "Reference to the User entity. (Relationship: User 1:1 Parent)"
        },
        "studentId": {
          "type": "string",
          "description": "Reference to the Student entity. (Relationship: Student 1:N Parent)"
        },
        "teacherId": {
          "type": "string",
          "description": "Reference to the Teacher entity. (Relationship: Teacher 1:N Parent)"
        },
        "isApproved": {
          "type": "boolean",
          "description": "Indicates whether the parent is approved by the teacher."
        }
      },
      "required": [
        "id",
        "userId",
        "studentId",
        "teacherId"
      ]
    },
    "StudyMaterial": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "StudyMaterial",
      "type": "object",
      "description": "Represents a study material resource.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the study material.",
          "format": "uuid"
        },
        "teacherId": {
          "type": "string",
          "description": "Reference to the Teacher entity. (Relationship: Teacher 1:N StudyMaterial)"
        },
        "title": {
          "type": "string",
          "description": "The title of the study material."
        },
        "description": {
          "type": "string",
          "description": "A description of the study material."
        },
        "fileUrl": {
          "type": "string",
          "description": "URL to the study material file.",
          "format": "uri"
        },
        "subject": {
          "type": "string",
          "description": "The subject of the study material."
        },
        "chapter": {
          "type": "string",
          "description": "The chapter the study material belongs to."
        },
        "type": {
          "type": "string",
          "description": "The type of study material (notes, DPP, test, etc.)."
        },
        "isFree": {
          "type": "boolean",
          "description": "Indicates whether the study material is free or teacher-specific."
        }
      },
      "required": [
        "id",
        "teacherId",
        "title",
        "fileUrl",
        "subject",
        "chapter",
        "type"
      ]
    },
    "Attendance": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Attendance",
      "type": "object",
      "description": "Represents a student's attendance record.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the attendance record.",
          "format": "uuid"
        },
        "studentId": {
          "type": "string",
          "description": "Reference to the Student entity. (Relationship: Student 1:N Attendance)"
        },
        "teacherId": {
          "type": "string",
          "description": "Reference to the Teacher entity. (Relationship: Teacher 1:N Attendance)"
        },
        "date": {
          "type": "string",
          "description": "The date of the attendance record.",
          "format": "date-time"
        },
        "isPresent": {
          "type": "boolean",
          "description": "Indicates whether the student was present."
        }
      },
      "required": [
        "id",
        "studentId",
        "teacherId",
        "date",
        "isPresent"
      ]
    },
    "Test": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Test",
      "type": "object",
      "description": "Represents a test or assessment.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the test.",
          "format": "uuid"
        },
        "teacherId": {
          "type": "string",
          "description": "Reference to the Teacher entity. (Relationship: Teacher 1:N Test)"
        },
        "title": {
          "type": "string",
          "description": "The title of the test."
        },
        "description": {
          "type": "string",
          "description": "A description of the test."
        },
        "studyMaterialId": {
          "type": "string",
          "description": "Reference to the StudyMaterial entity. (Relationship: Test 1:1 StudyMaterial).  Links the general study material record to this specific test instance."
        }
      },
      "required": [
        "id",
        "teacherId",
        "title",
        "studyMaterialId"
      ]
    },
    "Performance": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Performance",
      "type": "object",
      "description": "Represents a student's performance on a test.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the performance record.",
          "format": "uuid"
        },
        "studentId": {
          "type": "string",
          "description": "Reference to the Student entity. (Relationship: Student 1:N Performance)"
        },
        "testId": {
          "type": "string",
          "description": "Reference to the Test entity. (Relationship: Test 1:N Performance)"
        },
        "marks": {
          "type": "number",
          "description": "The marks obtained by the student on the test."
        },
        "remarks": {
          "type": "string",
          "description": "Any remarks or comments on the student's performance."
        }
      },
      "required": [
        "id",
        "studentId",
        "testId",
        "marks"
      ]
    },
    "DPPSubmission": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "DPPSubmission",
      "type": "object",
      "description": "Represents a student's submission of a Daily Practice Problem (DPP).",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the DPP submission record.",
          "format": "uuid"
        },
        "studentId": {
          "type": "string",
          "description": "Reference to the Student entity. (Relationship: Student 1:N DPPSubmission)"
        },
        "studyMaterialId": {
          "type": "string",
          "description": "Reference to the StudyMaterial entity. (Relationship: StudyMaterial 1:N DPPSubmission).  Links to the DPP study material."
        },
        "submissionDate": {
          "type": "string",
          "description": "The date and time of the DPP submission.",
          "format": "date-time"
        },
        "fileUrl": {
          "type": "string",
          "description": "URL to the submitted DPP file.",
          "format": "uri"
        }
      },
      "required": [
        "id",
        "studentId",
        "studyMaterialId",
        "submissionDate",
        "fileUrl"
      ]
    },
    "ClassSchedule": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ClassSchedule",
      "type": "object",
      "description": "Represents the schedule for a class.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the class schedule.",
          "format": "uuid"
        },
        "teacherId": {
          "type": "string",
          "description": "Reference to the Teacher entity. (Relationship: Teacher 1:N ClassSchedule)"
        },
        "dayOfWeek": {
          "type": "string",
          "description": "The day of the week for the class (e.g., Monday, Tuesday)."
        },
        "startTime": {
          "type": "string",
          "description": "The start time of the class (e.g., 10:00 AM)."
        },
        "endTime": {
          "type": "string",
          "description": "The end time of the class (e.g., 11:00 AM)."
        }
      },
      "required": [
        "id",
        "teacherId",
        "dayOfWeek",
        "startTime",
        "endTime"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles (teachers, students, parents).",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      },
      {
        "path": "/teachers/{teacherId}",
        "definition": {
          "entityName": "Teacher",
          "schema": {
            "$ref": "#/backend/entities/Teacher"
          },
          "description": "Stores teacher-specific data.",
          "params": [
            {
              "name": "teacherId",
              "description": "The unique identifier of the teacher."
            }
          ]
        }
      },
      {
        "path": "/students/{studentId}",
        "definition": {
          "entityName": "Student",
          "schema": {
            "$ref": "#/backend/entities/Student"
          },
          "description": "Stores student data, including the teacherId for teacher-connected students.",
          "params": [
            {
              "name": "studentId",
              "description": "The unique identifier of the student."
            }
          ]
        }
      },
      {
        "path": "/parents/{parentId}",
        "definition": {
          "entityName": "Parent",
          "schema": {
            "$ref": "#/backend/entities/Parent"
          },
          "description": "Stores parent data, linking them to students and teachers.",
          "params": [
            {
              "name": "parentId",
              "description": "The unique identifier of the parent."
            }
          ]
        }
      },
      {
        "path": "/studyMaterials/{studyMaterialId}",
        "definition": {
          "entityName": "StudyMaterial",
          "schema": {
            "$ref": "#/backend/entities/StudyMaterial"
          },
          "description": "Stores study materials, including the teacherId and a flag for free content (isFree).",
          "params": [
            {
              "name": "studyMaterialId",
              "description": "The unique identifier of the study material."
            }
          ]
        }
      },
      {
        "path": "/attendances/{attendanceId}",
        "definition": {
          "entityName": "Attendance",
          "schema": {
            "$ref": "#/backend/entities/Attendance"
          },
          "description": "Stores attendance records, linked to students and teachers.",
          "params": [
            {
              "name": "attendanceId",
              "description": "The unique identifier of the attendance record."
            }
          ]
        }
      },
      {
        "path": "/tests/{testId}",
        "definition": {
          "entityName": "Test",
          "schema": {
            "$ref": "#/backend/entities/Test"
          },
          "description": "Stores test information, associated with a teacher and study material.",
          "params": [
            {
              "name": "testId",
              "description": "The unique identifier of the test."
            }
          ]
        }
      },
      {
        "path": "/performances/{performanceId}",
        "definition": {
          "entityName": "Performance",
          "schema": {
            "$ref": "#/backend/entities/Performance"
          },
          "description": "Stores student performance data on tests.",
          "params": [
            {
              "name": "performanceId",
              "description": "The unique identifier of the performance record."
            }
          ]
        }
      },
      {
        "path": "/dPPSubmissions/{dPPSubmissionId}",
        "definition": {
          "entityName": "DPPSubmission",
          "schema": {
            "$ref": "#/backend/entities/DPPSubmission"
          },
          "description": "Stores student submissions for Daily Practice Problems.",
          "params": [
            {
              "name": "dPPSubmissionId",
              "description": "The unique identifier of the DPP submission record."
            }
          ]
        }
      },
      {
        "path": "/classSchedules/{classScheduleId}",
        "definition": {
          "entityName": "ClassSchedule",
          "schema": {
            "$ref": "#/backend/entities/ClassSchedule"
          },
          "description": "Stores class schedules, managed by teachers.",
          "params": [
            {
              "name": "classScheduleId",
              "description": "The unique identifier of the class schedule."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to support EduConnect Pro's role-based access, real-time updates, and study material features while prioritizing security and scalability.  The core principle applied is Authorization Independence, achieved through denormalization of authorization context. This eliminates the need for `get()` calls in security rules, enabling atomic operations and improving debuggability.\n\n**Users Collection:** Stores user profiles.  Access is controlled through authentication and role-based checks.\n\n**Teachers Collection:** Stores teacher-specific data.\n\n**Students Collection:** Stores student data. The `teacherId` field establishes the relationship with teachers.\n\n**Parents Collection:** Stores parent data, linking them to students and teachers.\n\n**StudyMaterials Collection:** Stores study materials. The `teacherId` field indicates the teacher who uploaded the material.  The `isFree` flag allows for open access to some materials.\n\n**Attendances Collection:** Stores attendance records, linked to students and teachers.\n\n**Tests Collection:** Stores test information, associated with a teacher and study material.\n\n**Performances Collection:** Stores student performance data on tests.\n\n**DPPSubmissions Collection:** Stores student submissions for Daily Practice Problems.\n\n**ClassSchedules Collection:** Stores class schedules, managed by teachers.\n\n**Authorization Independence & QAPs:**\n\n*   **Denormalization:** The structure uses path-based ownership and denormalization. For example, study materials are stored in a top-level `studyMaterials` collection but contain the `teacherId`. This allows rules to securely query all study materials for a specific teacher without requiring a `get()` call to the teacher document.\n\n*   **Structural Segregation:** The design segregates data based on access needs.  Teacher-specific data and student-specific data are kept in separate collections (`teachers`, `students`), which have different security rules. The `isFree` field in `studyMaterials` enables open access to some content while securing the rest.\n\n*   **QAPs Support:** The segregation of data into collections with homogeneous security postures supports secure `list` operations. Rules can allow listing of documents in `studyMaterials` where `isFree` is true, without complex filtering within the rule itself.\n\n**Overall, the structure provides a secure and scalable foundation for EduConnect Pro by enforcing role-based access, enabling real-time updates, and facilitating efficient management of study materials and student performance.**"
  }
}